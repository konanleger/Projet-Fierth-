---
title: "R Notebook"
output: html_notebook
---

```{r}

# Graphique : Prix normaux (dans les bornes)
ggplot(gnpd_tea %>%
         filter(`Price per 100 g/ml in Euros` >= borne_inf,
                `Price per 100 g/ml in Euros` <= borne_sup) %>%
         mutate(Market = fct_lump(Market, n = 15, other_level = "Autres marchés")),
       aes(x = reorder(Market, `Price per 100 g/ml in Euros`, FUN = median),
           y = `Price per 100 g/ml in Euros`)) +
  geom_boxplot(fill = "lightblue", alpha = 0.7) +
  coord_flip() +
  labs(
    title = "Distribution des Prix par Marché (valeurs normales)",
    subtitle = "Détection basée sur la méthode de Tukey",
    x = "Marché",
    y = "Prix (€/100g ou 100ml)"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))
```

```{python}

```

```{r}

```

## 3. Tests Statistiques

### 3.1 Test de Normalité de Shapiro-Wilk

```{r shapiro_test}
# Test de normalité de Shapiro-Wilk
# shapiro_test <- shapiro.test(gnpd_tea$`Price per 100 g/ml in Euros`)
# print("Test de normalité de Shapiro-Wilk :")
# print(shapiro_test)

# Interprétation du test
cat("\nInterprétation du test de Shapiro-Wilk :\n")
cat("H0 : La distribution des prix suit une loi normale\n")
cat("H1 : La distribution des prix ne suit pas une loi normale\n")
cat("Si p-value < 0.05, on rejette H0 et on conclut que la distribution n'est pas normale\n")
cat("Si p-value >= 0.05, on ne peut pas rejeter H0 et on considère la distribution comme normale\n")
```

### 3.2 Test de Kruskal-Wallis

```{r kruskal_wallis}
# Test de Kruskal-Wallis pour comparer les prix entre les marchés
kruskal_test <- kruskal.test(`Price per 100 g/ml in Euros` ~ Market, data = gnpd_tea)
print("Test de Kruskal-Wallis :")
print(kruskal_test)

# Interprétation du test
cat("\nInterprétation du test de Kruskal-Wallis :\n")
cat("H0 : Les distributions des prix sont identiques pour tous les marchés\n")
cat("H1 : Au moins un marché a une distribution des prix différente des autres\n")
cat("Si p-value < 0.05, on rejette H0 et on conclut qu'il existe des différences significatives entre les marchés\n")
cat("Si p-value >= 0.05, on ne peut pas rejeter H0 et on considère que les distributions sont similaires\n")

# Test post-hoc de Dunn
dunn_test <- dunn_test(`Price per 100 g/ml in Euros` ~ Market, data = gnpd_tea, p.adjust.method = "bonferroni")
print("\nTest post-hoc de Dunn :")
print(dunn_test)

# Interprétation du test post-hoc
cat("\nInterprétation du test post-hoc de Dunn :\n")
cat("Ce test permet d'identifier quelles paires de marchés diffèrent significativement\n")
cat("H0 : Les deux marchés comparés ont la même distribution de prix\n")
cat("H1 : Les deux marchés comparés ont des distributions de prix différentes\n")
cat("Si p.adj < 0.05, on rejette H0 et on conclut à une différence significative entre les deux marchés\n")
cat("Si p.adj >= 0.05, on ne peut pas rejeter H0 et on considère que les distributions sont similaires\n")
```

### 3.3 Analyse des Corrélations

```{r correlations}
# Création d'une matrice de corrélation
numeric_vars <- gnpd_tea %>%
  select(`Price per 100 g/ml in Euros`, `Unit Pack Size (ml/g)`, `Alcohol By Volume (%)`) %>%
  na.omit()

cor_matrix <- cor(numeric_vars)
print("Matrice de corrélation :")
print(cor_matrix)

# Test de corrélation de Spearman
spearman_test <- cor.test(gnpd_tea$`Price per 100 g/ml in Euros`, 
                         gnpd_tea$`Unit Pack Size (ml/g)`, 
                         method = "spearman")
print("\nTest de corrélation de Spearman :")
print(spearman_test)

# Interprétation du test de corrélation
cat("\nInterprétation du test de corrélation de Spearman :\n")
cat("H0 : Il n'y a pas de corrélation entre le prix et la taille de l'unité\n")
cat("H1 : Il existe une corrélation entre le prix et la taille de l'unité\n")
cat("Si p-value < 0.05, on rejette H0 et on conclut à l'existence d'une corrélation significative\n")
cat("Si p-value >= 0.05, on ne peut pas rejeter H0 et on considère qu'il n'y a pas de corrélation\n")
cat("Le coefficient de corrélation (rho) varie de -1 à 1 :\n")
cat("- Proche de 1 : forte corrélation positive\n")
cat("- Proche de 0 : pas de corrélation\n")
cat("- Proche de -1 : forte corrélation négative\n")
```

### 3.4 Test de Tendance Temporelle

```{r trend_test}
# Calcul des prix moyens par année
prix_par_annee <- gnpd_tea %>%
  mutate(annee = year(`Date Published`)) %>%
  filter(!is.na(annee)) %>%
  group_by(annee) %>%
  summarise(
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    n = n()
  )

# Test de tendance linéaire
trend_test <- cor.test(prix_par_annee$annee, prix_par_annee$prix_moyen, method = "spearman")
print("Test de tendance temporelle :")
print(trend_test)

# Interprétation du test de tendance
cat("\nInterprétation du test de tendance temporelle :\n")
cat("H0 : Il n'y a pas de tendance temporelle dans l'évolution des prix\n")
cat("H1 : Il existe une tendance temporelle dans l'évolution des prix\n")
cat("Si p-value < 0.05, on rejette H0 et on conclut à l'existence d'une tendance significative\n")
cat("Si p-value >= 0.05, on ne peut pas rejeter H0 et on considère qu'il n'y a pas de tendance\n")
cat("Le coefficient de corrélation (rho) indique :\n")
cat("- Une valeur positive : tendance à la hausse\n")
cat("- Une valeur négative : tendance à la baisse\n")
cat("- Une valeur proche de 0 : pas de tendance claire\n")

# Graphique de l'évolution des prix
ggplot(prix_par_annee, aes(x = annee, y = prix_moyen)) +
  geom_line() +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    title = "Évolution des Prix Moyens au Cours du Temps",
    x = "Année",
    y = "Prix Moyen (€/100g ou 100ml)"
  ) +
  theme_minimal()
```

## 4. Analyse des Valeurs Extrêmes

### 4.1 Identification des Produits les Plus Chers

```{r produits_chers}
# Identification des produits les plus chers
produits_chers <- gnpd_tea %>%
  arrange(desc(`Price per 100 g/ml in Euros`)) %>%
  select(Market, Product, `Price per 100 g/ml in Euros`) %>%
  head(10)

knitr::kable(produits_chers, 
             caption = "Top 10 des Produits les Plus Chers")
```

## 5. Analyse Temporelle

### 5.1 Évolution des Prix au Cours du Temps

```{r evolution_prix}
# Calcul des prix moyens par année
prix_par_annee <- gnpd_tea %>%
  mutate(annee = year(`Date Published`)) %>%
  filter(!is.na(annee)) %>%
  group_by(annee) %>%
  summarise(
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    n = n()
  )

# Test de tendance linéaire
trend_test <- cor.test(prix_par_annee$annee, prix_par_annee$prix_moyen, method = "spearman")
print("Test de tendance temporelle :")
print(trend_test)

# Graphique de l'évolution des prix
ggplot(prix_par_annee, aes(x = annee, y = prix_moyen)) +
  geom_line() +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE) +
  labs(
    title = "Évolution des Prix Moyens au Cours du Temps",
    x = "Année",
    y = "Prix Moyen (€/100g ou 100ml)"
  ) +
  theme_minimal()
```

## 6. Conclusion

Cette analyse approfondie de la catégorie Tea nous permet de :

1.  **Distribution des Prix** :
    -   Identifier les marchés avec les prix les plus élevés et les plus bas
    -   Comprendre la variabilité des prix dans chaque marché
    -   Détecter les valeurs aberrantes et les produits exceptionnels
2.  **Tests Statistiques** :
    -   Confirmer les différences significatives entre les marchés
    -   Identifier les corrélations entre les variables numériques
    -   Analyser les tendances temporelles des prix
3.  **Implications Marketing** :
    -   Guider les décisions de prix selon les marchés
    -   Comprendre les facteurs influençant les prix
    -   Identifier les opportunités de marché
