---
title: "Analyse Nutritionnelle des Produits de Thé"
author: "KOUASSI KONAN LEGER"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Introduction

Ce rapport présente une analyse détaillée des informations nutritionnelles des produits de thé disponibles dans la base de données GNPD. L'objectif est de comprendre les caractéristiques nutritionnelles des différents types de thé et d'identifier les tendances dans le marché.

## Structure du Rapport

1. Préparation des données
2. Analyse descriptive des valeurs nutritionnelles
3. Analyse par sous-catégorie
4. Visualisations et interprétations

# 1. Préparation des Données

## 1.1 Chargement des Packages

```{r packages}
# Chargement des packages nécessaires
library(readxl)
library(tidyverse)    # Pour la manipulation et la visualisation des données
library(lubridate)    # Pour la manipulation des dates
library(scales)       # Pour le formatage des graphiques
library(tm)          # Pour le traitement du texte
library(wordcloud)    # Pour la création de nuages de mots
library(tidytext)     # Pour l'analyse de texte
```

## 1.2 Importation et Nettoyage des Données

```{r import}
# Importation des données depuis le fichier Excel
gnpd <- read_excel("GNPD_tea.xlsx")

# Filtrage des données nutritionnelles
nutrition_data <- gnpd %>%
  filter(!is.na(Nutrition), Nutrition != "Not indicated on pack") %>%
  mutate(
    year = year(`Date Published`),
    price_per_100 = as.numeric(`Price per 100 g/ml in Euros`),
    Nutrition = tolower(Nutrition)
  )
```

## 1.3 Extraction des Valeurs Nutritionnelles

```{r extraction}
# Extraction des différentes composantes nutritionnelles
nutrition_data <- nutrition_data %>%
  mutate(
    # Énergie (en kJ et kcal)
    energy_kj = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*kj")),
    energy_kcal = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*kcal")),
    
    # Protéines
    proteins = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=protein)")),
    
    # Lipides
    fats = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=fat)")),
    saturated_fats = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=saturated fat)")),
    
    # Glucides et sucres
    carbs = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=carbohydrate)")),
    sugars = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=sugars)")),
    added_sugars = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=added sugars)")),
    
    # Sodium et sel
    sodium = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*(?:mg|g)\\s*(?=sodium)")),
    salt = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=salt)")),
    
    # Fibres
    fiber = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=dietary fibre|fiber)")),
    
    # Vitamines et minéraux
    vitamin_c = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*(?:mg|mcg|µg)\\s*(?=vitamin c)")),
    calcium = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*(?:mg|mcg|µg)\\s*(?=calcium)")),
    iron = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*(?:mg|mcg|µg)\\s*(?=iron)")),
    potassium = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*(?:mg|mcg|µg)\\s*(?=potassium)")),
    
    # Autres nutriments
    cholesterol = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*(?:mg|g)\\s*(?=cholesterol)")),
    trans_fat = as.numeric(str_extract(Nutrition, "(\\d+(\\.\\d+)?)\\s*g\\s*(?=trans fat)"))
  )

# Conversion de l'énergie en une seule unité (kcal)
nutrition_data <- nutrition_data %>%
  mutate(
    energy = case_when(
      !is.na(energy_kcal) ~ energy_kcal,
      !is.na(energy_kj) ~ energy_kj/4.184,  # Conversion kJ en kcal
      TRUE ~ NA_real_
    )
  )
```

# 2. Analyse Descriptive

## 2.1 Statistiques Descriptives

```{r stats}
# Calcul des statistiques descriptives
summary_stats <- nutrition_data %>%
  summarise(
    across(
      c(energy_kj, energy_kcal, proteins, fats, saturated_fats, 
        carbs, sugars, added_sugars, sodium, salt, fiber, 
        vitamin_c, calcium, iron, potassium, cholesterol, trans_fat),
      list(
        mean = ~mean(., na.rm = TRUE),
        median = ~median(., na.rm = TRUE),
        sd = ~sd(., na.rm = TRUE),
        n = ~sum(!is.na(.))
      )
    )
  )

# Affichage des statistiques
knitr::kable(summary_stats, caption = "Statistiques descriptives des valeurs nutritionnelles")
```

## 2.2 Visualisations des Distributions

```{r viz_energy}
# Distribution de l'énergie
ggplot(nutrition_data %>% filter(!is.na(energy)), aes(x = energy)) +
  geom_histogram(fill = "skyblue", bins = 30) +
  labs(
    title = "Distribution de l'Énergie (kcal)",
    x = "Énergie (kcal)",
    y = "Nombre de produits"
  ) +
  theme_minimal()
```

```{r viz_sugars}
# Distribution des sucres
ggplot(nutrition_data %>% filter(!is.na(sugars)), aes(x = sugars)) +
  geom_histogram(fill = "lightgreen", bins = 30) +
  labs(
    title = "Distribution des Sucres",
    x = "Sucres (g)",
    y = "Nombre de produits"
  ) +
  theme_minimal()
```

# 3. Analyse par Sous-catégorie

## 3.1 Statistiques par Catégorie

```{r category_stats}
# Analyse par sous-catégorie
nutrition_par_categorie <- nutrition_data %>%
  group_by(`Sub-Category`) %>%
  summarise(
    n = n(),
    mean_energy = mean(energy_kcal, na.rm = TRUE),
    mean_sugar = mean(sugars, na.rm = TRUE),
    mean_sodium = mean(sodium, na.rm = TRUE),
    mean_vitamin_c = mean(vitamin_c, na.rm = TRUE)
  ) %>%
  filter(n >= 10) %>%
  arrange(desc(n))

# Affichage des résultats
knitr::kable(nutrition_par_categorie %>% head(10), 
             caption = "Top 10 des sous-catégories par nombre de produits")
```

## 3.2 Visualisation des Catégories

```{r category_viz}
# Top 10 des sous-catégories par énergie moyenne
ggplot(nutrition_par_categorie %>% head(10), 
       aes(x = reorder(`Sub-Category`, mean_energy), y = mean_energy)) +
  geom_col(fill = "darkblue") +
  coord_flip() +
  labs(
    title = "Top 10 des Sous-catégories par Énergie Moyenne",
    x = "Sous-catégorie",
    y = "Énergie moyenne (kcal)"
  ) +
  theme_minimal()
```

# 4. Conclusion

Cette analyse nous a permis de :
- Comprendre la distribution des valeurs nutritionnelles dans les produits de thé
- Identifier les sous-catégories les plus représentées
- Analyser les tendances nutritionnelles par catégorie

Les résultats montrent que...

# 5. Annexes

## 5.1 Code Source

Le code source complet est disponible dans le fichier `analyse_nutrition.R`.

## 5.2 Données Brutes

Les données brutes sont stockées dans le fichier `GNPD_tea.xlsx`.

## 5.3 Fichiers de Sortie

Les résultats détaillés sont sauvegardés dans :
- `nutrition_statistics.csv` : Statistiques descriptives
- `nutrition_by_category.csv` : Analyse par catégorie 