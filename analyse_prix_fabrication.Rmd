---
title: "Analyse des Prix selon le Lieu de Fabrication"
author: "KOUASSI KONAN LEGER"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Analyse des Prix selon le Lieu de Fabrication

## 1. Chargement des Données et Packages

```{r packages}
# Chargement des packages nécessaires
library(readxl)
library(tidyverse)
library(dplyr)
library(lubridate)
library(wordcloud)
library(tidytext)
library(scales)
```

```{r import}
# Importation des données
gnpd <- read_excel("GNPD_tea.xlsx")

gnpd <- gnpd %>%
  mutate(
    `Price per 100 g/ml in Euros` = as.numeric(`Price per 100 g/ml in Euros`),
    `Price in US Dollars` = as.numeric(`Price in US Dollars`),
    `Price in Euros` = as.numeric(`Price in Euros`),
    `Unit Pack Size (ml/g)` = as.numeric(`Unit Pack Size (ml/g)`),
    `Alcohol By Volume (%)` = as.numeric(`Alcohol By Volume (%)`),
    `Bar Code` = as.character(`Bar Code`),
    `Date Published` = as.Date(`Date Published`)  
  )
gnpd <- gnpd %>%
  filter(`Sub-Category` %in% c("Tea", "RTD (Iced) Tea")) %>%
  filter(!is.na(`Price per 100 g/ml in Euros`))
```

## 2. Analyse Descriptive

### 2.1 Distribution des Prix par Lieu de Fabrication

```{r boxplot}
# Création d'un graphique boxplot pour visualiser la distribution des prix par lieu de fabrication
ggplot(gnpd %>% 
         filter(!is.na(`Price per 100 g/ml in Euros`), 
                !is.na(`Location of Manufacture`),
                `Price per 100 g/ml in Euros` < 100) %>% # Filtrage des valeurs extrêmes
         mutate(`Location of Manufacture` = fct_lump(`Location of Manufacture`, n = 15, other_level = "Autres pays")), # Regroupement des pays
       aes(x = reorder(`Location of Manufacture`, `Price per 100 g/ml in Euros`, FUN = median), 
           y = `Price per 100 g/ml in Euros`)) +
  geom_boxplot(fill = "lightblue", alpha = 0.7) +
  coord_flip() +
  labs(
    title = "Distribution des Prix par Lieu de Fabrication",
    subtitle = "Top 15 des pays + Autres pays regroupés",
    x = "Pays de Fabrication",
    y = "Prix (€/100g ou 100ml)"
  ) +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 8))
```

### 2.2 Statistiques par Pays de Fabrication

```{r stats_pays}
# Calcul des statistiques par pays
prix_par_pays <- gnpd %>%
  filter(!is.na(`Price per 100 g/ml in Euros`),
         !is.na(`Location of Manufacture`)) %>%
  group_by(`Location of Manufacture`) %>%
  summarise(
    n = n(),
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_median = median(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_min = min(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_max = max(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    ecart_type = sd(`Price per 100 g/ml in Euros`, na.rm = TRUE)
  ) %>%
  arrange(desc(prix_moyen))

# Affichage des résultats
knitr::kable(prix_par_pays %>% head(15), 
             caption = "Top 15 des pays par prix moyen")
```

## 3. Analyse des Valeurs Extrêmes

### 3.1 Produits les Plus Chers par Pays

```{r produits_chers_pays}
# Identification des produits les plus chers par pays
produits_chers_pays <- gnpd %>%
  filter(!is.na(`Price per 100 g/ml in Euros`),
         !is.na(`Location of Manufacture`)) %>%
  group_by(`Location of Manufacture`) %>%
  slice_max(`Price per 100 g/ml in Euros`, n = 3) %>%
  select(`Location of Manufacture`, Product, `Sub-Category`, `Price per 100 g/ml in Euros`) %>%
  arrange(`Location of Manufacture`, desc(`Price per 100 g/ml in Euros`))

knitr::kable(produits_chers_pays %>% head(15), 
             caption = "Top 3 des Produits les Plus Chers par Pays (15 premiers pays)")
```

## 4. Analyse par Région

### 4.1 Création des Régions

```{r regions}
# Création d'une variable région
gnpd <- gnpd %>%
  mutate(
    Region = case_when(
      `Location of Manufacture` %in% c("China", "Japan", "South Korea", "Taiwan, China", "Hong Kong, China", "Inde","Bangladesh","Sri Lanka",
                                     "Vietnam", "Thailand", "Indonesia", "Malaysia", "Philippines", 
                                     "Singapore", "Myanmar", "Cambodia", "Lao People's Democratic Republic") ~ "Asie",
      `Location of Manufacture` %in% c("UK", "France", "Germany", "Italy", "Spain", "Switzerland", 
                                     "Netherlands", "Belgium", "Sweden", "Denmark", "Norway", "Finland", 
                                     "Austria", "Poland", "Greece", "Portugal", "Ireland", "Luxembourg") ~ "Europe",
      `Location of Manufacture` %in% c("USA", "Canada", "Mexico") ~ "Amérique du Nord",
      `Location of Manufacture` %in% c("Brazil", "Argentina", "Colombia", "Chile", "Peru", "Venezuela", 
                                     "Ecuador", "Paraguay", "Uruguay") ~ "Amérique du Sud",
      `Location of Manufacture` %in% c("Australia", "New Zealand") ~ "Océanie",
      `Location of Manufacture` %in% c("South Africa", "Kenya", "Tanzania", "Uganda", "Nigeria", 
                                     "Egypt", "Morocco", "Algeria") ~ "Afrique",
      `Location of Manufacture` %in% c("United Arab Emirates", "Saudi Arabia", "Israel", "Turkey","Pakistan",
                                     "Iran", "Jordan", "Oman", "Qatar") ~ "Moyen-Orient",
      TRUE ~ "Autres"
    )
  )
```

### 4.2 Analyse des Prix par Région

```{r prix_region}
# Statistiques par région
prix_par_region <- gnpd %>%
  filter(!is.na(`Price per 100 g/ml in Euros`)) %>%
  group_by(Region) %>%
  summarise(
    n = n(),
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_median = median(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_min = min(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_max = max(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    ecart_type = sd(`Price per 100 g/ml in Euros`, na.rm = TRUE)
  ) %>%
  arrange(desc(prix_moyen))

# Affichage des résultats
knitr::kable(prix_par_region, 
             caption = "Statistiques des Prix par Région")

# Graphique des prix moyens par région
ggplot(prix_par_region, 
       aes(x = reorder(Region, prix_moyen), y = prix_moyen)) +
  geom_col(fill = "darkblue") +
  coord_flip() +
  labs(
    title = "Prix Moyen par Région de Fabrication",
    x = "Région",
    y = "Prix Moyen (€/100g ou 100ml)"
  ) +
  theme_minimal()
```

## 5. Analyse Temporelle des Prix

### 5.1 Évolution des Prix Moyens par Année

```{r evolution_prix}
# Création d'une variable année
gnpd <- gnpd %>%
  mutate(annee = year(`Date Published`))

# Calcul des prix moyens par année
prix_par_annee <- gnpd %>%
  filter(!is.na(`Price per 100 g/ml in Euros`),
         !is.na(annee)) %>%
  group_by(annee) %>%
  summarise(
    n = n(),
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_median = median(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_min = min(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_max = max(`Price per 100 g/ml in Euros`, na.rm = TRUE)
  ) %>%
  arrange(annee)

# Graphique de l'évolution des prix moyens
ggplot(prix_par_annee, aes(x = annee, y = prix_moyen)) +
  geom_line(color = "darkblue", size = 1) +
  geom_point(color = "darkblue", size = 2) +
  geom_smooth(method = "loess", se = TRUE, color = "red", alpha = 0.2) +
  labs(
    title = "Évolution des Prix Moyens au Cours du Temps",
    subtitle = "Avec tendance (ligne rouge)",
    x = "Année",
    y = "Prix Moyen (€/100g ou 100ml)"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(prix_par_annee$annee), max(prix_par_annee$annee), by = 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Affichage des statistiques annuelles
knitr::kable(prix_par_annee, 
             caption = "Statistiques des Prix par Année")
```

### 5.1 bis Évolution des Prix Médians par Année

```{r evolution_prix_median}
# Graphique de l'évolution des prix médians
# On utilise le tableau prix_par_annee déjà calculé précédemment

ggplot(prix_par_annee, aes(x = annee, y = prix_median)) +
  geom_line(color = "darkgreen", size = 1) +
  geom_point(color = "darkgreen", size = 2) +
  geom_smooth(method = "loess", se = TRUE, color = "orange", alpha = 0.2) +
  labs(
    title = "Évolution des Prix Médians au Cours du Temps",
    subtitle = "Avec tendance (ligne orange)",
    x = "Année",
    y = "Prix Médian (€/100g ou 100ml)"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(prix_par_annee$annee), max(prix_par_annee$annee), by = 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

> Ce graphique permet de visualiser l'évolution du prix médian, qui est moins sensible aux valeurs extrêmes que la moyenne. Il donne une vision complémentaire de la dynamique des prix au fil des années.

### 5.2 Évolution des Prix par Région

```{r evolution_prix_region}
# Calcul des prix moyens par année et par région
prix_par_annee_region <- gnpd %>%
  filter(!is.na(`Price per 100 g/ml in Euros`),
         !is.na(annee),
         !is.na(Region)) %>%
  group_by(annee, Region) %>%
  summarise(
    n = n(),
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE)
  ) %>%
  arrange(annee, Region)

# Graphique de l'évolution des prix moyens par région
ggplot(prix_par_annee_region, 
       aes(x = annee, y = prix_moyen, color = Region, group = Region)) +
  geom_line(size = 1) +
  geom_point(size = 2) +
  labs(
    title = "Évolution des Prix Moyens par Région",
    x = "Année",
    y = "Prix Moyen (€/100g ou 100ml)",
    color = "Région"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(prix_par_annee_region$annee), 
                                max(prix_par_annee_region$annee), by = 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "bottom")
```

## 6. Conclusion

Cette analyse nous permet de :
- Visualiser la distribution des prix selon le pays de fabrication
- Identifier les pays avec les prix les plus élevés et les plus bas
- Comprendre la variabilité des prix dans chaque pays
- Analyser les tendances de prix par région géographique
- Observer l'évolution des prix au cours du temps
- Comparer les tendances de prix entre les différentes régions

Les résultats montrent que :
- Certains pays asiatiques (comme le Japon et la Chine) tendent à avoir des prix plus élevés
- Les pays européens montrent une grande variabilité dans leurs prix
- Il existe des différences significatives de prix entre les régions géographiques
- La qualité et le positionnement des produits varient considérablement selon le pays de fabrication
- Les prix montrent une tendance à l'évolution au cours du temps
- Les différentes régions suivent des tendances de prix distinctes 