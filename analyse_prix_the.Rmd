---
title: "Analyse des Prix des Produits de Th√© (Tea & RTD Iced Tea)"
author: "KOUASSI KONAN LEGER"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
    highlight: tango
---

# üß™ Objectif de l'analyse

Analyser les facteurs associ√©s au prix par 100g/ml en euros des produits de type "Tea" et "RTD (Iced) Tea" dans la base GNPD. L'analyse s'int√©ressera aux effets potentiels de plusieurs variables explicatives sur le prix.

# 1. üóÇÔ∏è Filtrage du sous-ensemble "Th√©"

```{r filtrage_the}
# Chargement des packages
library(readxl)
library(dplyr)
library(tidyverse)
library(lubridate)
library(scales)
library(knitr)

# Importation des donn√©es (√† adapter si besoin)
gnpd <- readxl::read_excel("GNPD_tea.xlsx")

gnpd <- gnpd %>%
  mutate(
    `Price per 100 g/ml in Euros` = as.numeric(`Price per 100 g/ml in Euros`),
    `Price in US Dollars` = as.numeric(`Price in US Dollars`),
    `Price in Euros` = as.numeric(`Price in Euros`),
    `Unit Pack Size (ml/g)` = as.numeric(`Unit Pack Size (ml/g)`),
    `Alcohol By Volume (%)` = as.numeric(`Alcohol By Volume (%)`),
    `Bar Code` = as.character(`Bar Code`),
    `Date Published` = as.Date(`Date Published`)  
  )

# creation de la variable region
gnpd <- gnpd %>%
  mutate(
    Region = case_when(
      Market %in% c("China", "Japan", "South Korea", "Taiwan, China", "Hong Kong,China", 
                    "Vietnam", "Thailand", "Indonesia", "Malaysia", "Philippines", 
                    "Singapore", "Myanmar", "Cambodia", "Laos","Sri Lanka","India","Bangladesh",
                    "Hong Kong, China") ~ "Asie",
      Market %in% c("UK", "France", "Germany", "Italy", "Spain", "Switzerland", 
                    "Netherlands", "Belgium", "Sweden", "Denmark", "Norway", "Finland", 
                    "Austria", "Poland", "Greece", "Portugal", "Ireland", "Luxembourg",
                    "Czech Republic", "Slovakia", "Slovenia", "Estonia", "Latvia", 
                    "Lithuania", "Hungary", "Romania", "Bulgaria", "Croatia", "Serbia",
                    "Ukraine", "Belarus", "Russia") ~ "Europe",
      Market %in% c("USA", "Canada", "Mexico", "Puerto Rico") ~ "Am√©rique du Nord",
      Market %in% c("Brazil", "Argentina", "Colombia", "Chile", "Peru", "Venezuela", 
                    "Ecuador", "Paraguay", "Uruguay", "Panama", "Costa Rica", 
                    "Guatemala") ~ "Am√©rique du Sud",
      Market %in% c("Australia", "New Zealand") ~ "Oc√©anie",
      Market %in% c("South Africa", "Kenya", "Tanzania", "Uganda", "Nigeria", 
                    "Egypt", "Morocco", "Algeria", "Tunisia", "Ghana", "Ivory Coast",
                    "Ethiopia", "Cameroon") ~ "Afrique",
      Market %in% c("UAE", "Saudi Arabia", "Israel", "Turkey", "Iran", "Jordan", 
                    "Oman", "Qatar", "Kuwait", "Lebanon", "Bahrain","Pakistan") ~ "Moyen-Orient",
      TRUE ~ "Autres"
    )
  )
# Filtrage des sous-cat√©gories d'int√©r√™t
tea_data <- gnpd %>%
  filter(`Sub-Category` %in% c("Tea", "RTD (Iced) Tea")) %>%
  filter(!is.na(`Price per 100 g/ml in Euros`))

# Aper√ßu des donn√©es filtr√©es
knitr::kable(head(tea_data), caption = "Aper√ßu des donn√©es filtr√©es (Tea & RTD Iced Tea)")
```

# 2. üìä Analyse descriptive du prix

```{r descriptif_prix}
# Statistiques descriptives
prix_stats <- tea_data %>%
  summarise(
    n = n(),
    moyenne = mean(`Price per 100 g/ml in Euros`),
    mediane = median(`Price per 100 g/ml in Euros`),
    min = min(`Price per 100 g/ml in Euros`),
    max = max(`Price per 100 g/ml in Euros`),
    ecart_type = sd(`Price per 100 g/ml in Euros`)
  )
knitr::kable(prix_stats, caption = "Statistiques descriptives du prix (‚Ç¨/100g ou 100ml)")

# Histogramme + densit√©
tea_data %>%
  ggplot(aes(x = `Price per 100 g/ml in Euros`)) +
  geom_histogram(aes(y = ..density..), bins = 50, fill = "skyblue", alpha = 0.7) +
  geom_density(color = "darkblue", size = 1) +
  labs(title = "Distribution du Prix (‚Ç¨/100g ou 100ml)", x = "Prix (‚Ç¨/100g ou 100ml)", y = "Densit√©") +
  theme_minimal()

# √âvolution du prix moyen et m√©dian par ann√©e
prix_par_annee <- tea_data %>%
  mutate(annee = year(`Date Published`)) %>%
  filter(!is.na(`Price per 100 g/ml in Euros`), !is.na(annee)) %>%
  group_by(annee) %>%
  summarise(
    n = n(),
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_median = median(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_min = min(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_max = max(`Price per 100 g/ml in Euros`, na.rm = TRUE)
  ) %>%
  arrange(annee)

# Graphique de l'√©volution des prix moyens
library(ggplot2)
ggplot(prix_par_annee, aes(x = annee, y = prix_moyen)) +
  geom_line(color = "darkblue", size = 1) +
  geom_point(color = "darkblue", size = 2) +
  geom_smooth(method = "loess", se = TRUE, color = "red", alpha = 0.2) +
  labs(
    title = "√âvolution des Prix Moyens au Cours du Temps",
    subtitle = "Avec tendance (ligne rouge)",
    x = "Ann√©e",
    y = "Prix Moyen (‚Ç¨/100g ou 100ml)"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(prix_par_annee$annee), max(prix_par_annee$annee), by = 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Graphique de l'√©volution des prix m√©dians
ggplot(prix_par_annee, aes(x = annee, y = prix_median)) +
  geom_line(color = "darkgreen", size = 1) +
  geom_point(color = "darkgreen", size = 2) +
  geom_smooth(method = "loess", se = TRUE, color = "orange", alpha = 0.2) +
  labs(
    title = "√âvolution des Prix M√©dians au Cours du Temps",
    subtitle = "Avec tendance (ligne orange)",
    x = "Ann√©e",
    y = "Prix M√©dian (‚Ç¨/100g ou 100ml)"
  ) +
  theme_minimal() +
  scale_x_continuous(breaks = seq(min(prix_par_annee$annee), max(prix_par_annee$annee), by = 1)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

# 3. üßÆ √âtude univari√©e des effets sur le prix

## 3.1 Date Published (ann√©e)

```{r effet_annee}
# Cr√©ation de la variable ann√©e
tea_data <- tea_data %>% mutate(annee = year(`Date Published`))

# Boxplot par ann√©e
tea_data %>%
  ggplot(aes(x = as.factor(annee), y = `Price per 100 g/ml in Euros`)) +
  geom_boxplot(fill = "orange", alpha = 0.7) +
  labs(title = "Distribution du prix par ann√©e de publication", x = "Ann√©e", y = "Prix (‚Ç¨/100g ou 100ml)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## 3.2 Number of Variants (corr√©lation)

```{r effet_nb_variants}
# Corr√©lation et nuage de points
tea_data %>%
  filter(!is.na(`Number of Variants`)) %>%
  ggplot(aes(x = `Number of Variants`, y = `Price per 100 g/ml in Euros`)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "lm", color = "red") +
  labs(title = "Prix vs Nombre de Variants", x = "Nombre de Variants", y = "Prix (‚Ç¨/100g ou 100ml)") +
  theme_minimal()

# Corr√©lation de Pearson
cor_nbvar <- cor.test(tea_data$`Number of Variants`, tea_data$`Price per 100 g/ml in Euros`, use = "complete.obs")
cor_nbvar
```

## 3.3 Market (pays)

```{r evolution_market}
# √âvolution du prix moyen par ann√©e et par march√© (top 10 march√©s)
prix_annee_market <- tea_data %>%
  group_by(annee, Market) %>%
  summarise(
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_sd = sd(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    n = n()
  ) %>%
  ungroup() %>%
  group_by(Market) %>%
  filter(sum(n) > 50) %>% # Garde les march√©s avec assez d'observations
  ungroup()

# Calcul de l'intervalle de confiance (approx 95%)
prix_annee_market <- prix_annee_market %>%
  mutate(
    ic_inf = prix_moyen - 1.96 * prix_sd / sqrt(n),
    ic_sup = prix_moyen + 1.96 * prix_sd / sqrt(n)
  )

ggplot(prix_annee_market, aes(x = annee, y = prix_moyen, color = Market, group = Market)) +
  geom_line() +
  geom_point() +
  geom_ribbon(aes(ymin = ic_inf, ymax = ic_sup, fill = Market), alpha = 0.15, color = NA) +
  geom_smooth(aes(group = Market), method = "lm", se = FALSE, linetype = "dashed", size = 0.7) +
  labs(title = "√âvolution du prix moyen par ann√©e et par march√© (top march√©s)",
       x = "Ann√©e", y = "Prix moyen (‚Ç¨/100g ou 100ml)", color = "March√©", fill = "March√©") +
  theme_minimal()
```

## 3.4 Location of Manufacture

```{r evolution_location}
# √âvolution du prix moyen par ann√©e et par lieu de fabrication (top 10)
prix_annee_loc <- tea_data %>%
  filter(!is.na(`Location of Manufacture`)) %>%
  group_by(annee, `Location of Manufacture`) %>%
  summarise(
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_sd = sd(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    n = n()
  ) %>%
  ungroup() %>%
  group_by(`Location of Manufacture`) %>%
  filter(sum(n) > 50) %>%
  ungroup()

prix_annee_loc <- prix_annee_loc %>%
  mutate(
    ic_inf = prix_moyen - 1.96 * prix_sd / sqrt(n),
    ic_sup = prix_moyen + 1.96 * prix_sd / sqrt(n)
  )

ggplot(prix_annee_loc, aes(x = annee, y = prix_moyen, color = `Location of Manufacture`, group = `Location of Manufacture`)) +
  geom_line() +
  geom_point() +
  geom_ribbon(aes(ymin = ic_inf, ymax = ic_sup, fill = `Location of Manufacture`), alpha = 0.15, color = NA) +
  geom_smooth(aes(group = `Location of Manufacture`), method = "lm", se = FALSE, linetype = "dashed", size = 0.7) +
  labs(title = "√âvolution du prix moyen par ann√©e et par lieu de fabrication (top lieux)",
       x = "Ann√©e", y = "Prix moyen (‚Ç¨/100g ou 100ml)", color = "Lieu de fabrication", fill = "Lieu de fabrication") +
  theme_minimal()
```

## 3.5 Brand (regroupement)

```{r evolution_brand}
# √âvolution du prix moyen par ann√©e et par marque (top 10)
prix_annee_brand <- tea_data %>%
  group_by(annee, Brand) %>%
  summarise(
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_sd = sd(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    n = n()
  ) %>%
  ungroup() %>%
  group_by(Brand) %>%
  filter(sum(n) > 50) %>%
  ungroup()

prix_annee_brand <- prix_annee_brand %>%
  mutate(
    ic_inf = prix_moyen - 1.96 * prix_sd / sqrt(n),
    ic_sup = prix_moyen + 1.96 * prix_sd / sqrt(n)
  )

ggplot(prix_annee_brand, aes(x = annee, y = prix_moyen, color = Brand, group = Brand)) +
  geom_line() +
  geom_point() +
  geom_ribbon(aes(ymin = ic_inf, ymax = ic_sup, fill = Brand), alpha = 0.15, color = NA) +
  geom_smooth(aes(group = Brand), method = "lm", se = FALSE, linetype = "dashed", size = 0.7) +
  labs(title = "√âvolution du prix moyen par ann√©e et par marque (top marques)",
       x = "Ann√©e", y = "Prix moyen (‚Ç¨/100g ou 100ml)", color = "Marque", fill = "Marque") +
  theme_minimal()
```

## 3.6 Launch Type

```{r evolution_launch_type}
# √âvolution du prix moyen par ann√©e et par type de lancement
prix_annee_launch <- tea_data %>%
  group_by(annee, `Launch Type`) %>%
  summarise(
    prix_moyen = mean(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    prix_sd = sd(`Price per 100 g/ml in Euros`, na.rm = TRUE),
    n = n()
  ) %>%
  ungroup() %>%
  filter(!is.na(`Launch Type`))

prix_annee_launch <- prix_annee_launch %>%
  mutate(
    ic_inf = prix_moyen - 1.96 * prix_sd / sqrt(n),
    ic_sup = prix_moyen + 1.96 * prix_sd / sqrt(n)
  )

ggplot(prix_annee_launch, aes(x = annee, y = prix_moyen, color = `Launch Type`, group = `Launch Type`)) +
  geom_line() +
  geom_point() +
  geom_ribbon(aes(ymin = ic_inf, ymax = ic_sup, fill = `Launch Type`), alpha = 0.15, color = NA) +
  geom_smooth(aes(group = `Launch Type`), method = "lm", se = FALSE, linetype = "dashed", size = 0.7) +
  labs(title = "√âvolution du prix moyen par ann√©e et par type de lancement",
       x = "Ann√©e", y = "Prix moyen (‚Ç¨/100g ou 100ml)", color = "Type de lancement", fill = "Type de lancement") +
  theme_minimal()
```

## 3.7 Package Type

```{r effet_package_type}
# ANOVA
anova_packtype <- aov(`Price per 100 g/ml in Euros` ~ `Package Type`, data = tea_data)
summary(anova_packtype)
```

## 3.8 Package Material

```{r effet_package_material}
# ANOVA
anova_packmat <- aov(`Price per 100 g/ml in Euros` ~ `Package Material`, data = tea_data)
summary(anova_packmat)
```

## 3.9 Import Status

```{r effet_import_status}
# t-test ou ANOVA selon le nombre de modalit√©s
if(length(unique(na.omit(tea_data$`Import Status`))) == 2){
  ttest_import <- t.test(`Price per 100 g/ml in Euros` ~ `Import Status`, data = tea_data)
  ttest_import
} else {
  anova_import <- aov(`Price per 100 g/ml in Euros` ~ `Import Status`, data = tea_data)
  summary(anova_import)
}
```

## 3.10 Private Label

```{r effet_private_label}
# t-test Branded vs Private Label
if(length(unique(na.omit(tea_data$`Private Label`))) == 2){
  ttest_label <- t.test(`Price per 100 g/ml in Euros` ~ `Private Label`, data = tea_data)
  ttest_label
} else {
  anova_label <- aov(`Price per 100 g/ml in Euros` ~ `Private Label`, data = tea_data)
  summary(anova_label)
}
```

# 4. üîé V√©rification des hypoth√®ses et tests compl√©mentaires

```{r tests_complementaires}
# Test de Bartlett pour l'homog√©n√©it√© des variances (exemple sur Launch Type)
bartlett.test(`Price per 100 g/ml in Euros` ~ `Launch Type`, data = tea_data)

# Test de Levene (si besoin)
# library(car)
# leveneTest(`Price per 100 g/ml in Euros` ~ `Launch Type`, data = tea_data)
```

# 5. üìâ Visualisations compl√©mentaires

```{r visualisations_complementaires}
# Densit√© par sous-cat√©gorie
tea_data %>%
  ggplot(aes(x = `Price per 100 g/ml in Euros`, fill = `Sub-Category`)) +
  geom_density(alpha = 0.5) +
  labs(
    title = "Densit√© des prix par sous-cat√©gorie",
    x = "Prix (‚Ç¨/100g ou 100ml)",
    y = "Densit√©"
  ) +
  theme_minimal()

# Violin plot par Launch Type
tea_data %>%
  ggplot(aes(x = `Launch Type`, y = `Price per 100 g/ml in Euros`, fill = `Launch Type`)) +
  geom_violin(alpha = 0.7) +
  geom_boxplot(width = 0.2, fill = "white", alpha = 0.5) +
  coord_flip() +
  labs(
    title = "Distribution des prix par type de lancement",
    x = "Type de lancement",
    y = "Prix (‚Ç¨/100g ou 100ml)"
  ) +
  theme_minimal()

# Camembert (pie chart) de la variable Region
region_pie <- tea_data %>%
  filter(!is.na(Region)) %>%
  count(Region) %>%
  mutate(pct = n / sum(n) * 100,
         label = paste0(Region, " (", round(pct, 1), "%)"))

ggplot(region_pie, aes(x = "", y = pct, fill = Region)) +
  geom_col(width = 1, color = "white") +
  coord_polar(theta = "y") +
  labs(
    title = "R√©partition des produits par r√©gion",
    fill = "R√©gion"
  ) +
  theme_void() +
  geom_text(aes(label = label), position = position_stack(vjust = 0.5), size = 3)
```

# 6. Conclusion

Cette analyse permet d'identifier les facteurs associ√©s au prix des produits de th√© (Tea et RTD Iced Tea) et de visualiser les diff√©rences selon les caract√©ristiques du produit, du packaging, du march√© et du type de lancement. Les r√©sultats peuvent guider la strat√©gie de positionnement et de tarification des produits sur le march√© du th√©. 